plugins {
    id 'java'
    id 'groovy'
    id 'org.springframework.boot'
    id 'io.spring.dependency-management' version '1.0.4.RELEASE'
    id 'application'
}

apply plugin: 'war'

war {
    baseName = 'gradleExample'
    description = 'A War file sample generated by Gradle '
    exclude("/WEB-INF/views/**")
}

configurations {
    integrationTestImplementation.extendsFrom testImplementation
    integrationTestRuntimeOnly.extendsFrom testRuntimeOnly
}

dependencies {
	annotationProcessor "io.micronaut:micronaut-inject-java"
    api("io.micronaut:micronaut-http-client")
    compileOnly 'org.projectlombok:lombok'
    developmentOnly "org.springframework.boot:spring-boot-devtools"
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-jdbc'
    developmentOnly 'org.hsqldb:hsqldb:2.3.4'
    runtimeOnly 'com.h2database:h2'
    runtimeOnly 'mysql:mysql-connector-java'
    testImplementation('org.springframework.boot:spring-boot-starter-test') {
        exclude group: 'org.junit.vintage', module: 'junit-vintage-engine'
    }
    groovy 'org.codehaus.groovy:groovy-all'
    testCompile "org.junit.jupiter:junit-jupiter-api"
    testCompile "org.junit.jupiter:junit-jupiter-engine"
    testCompile "org.junit.vintage:junit-vintage-engine"
    testCompile "io.micronaut:micronaut-http-client"
}

tasks.create("integrationTest", Test) {
    description = 'Runs Integration Tests'
    group = 'verification'
    testClassesDirs = sourceSets.integrationTest.output.classesDirs
    classpath = sourceSets.integrationTest.runtimeClasspath
}

task unusedDeps(type: DependencyReportTask, dependsOn: unusedTestRuntimeDeps) {
    outputDir = file("$buildDir/reports/unusedDeps")
    descriptorReportConfigs = [configurations.implementation]
}

import org.gradle.api.tasks.Copy

task copyLibs(type: Copy, dependsOn: unusedDeps) {
    group "verification"
    from unusedDeps.outputDir
    into "$buildRoot/dist"
}

tasks.named('build') {
    dependsOn copyLibs
}

configurations{
    compile.exclude module: "spring-boot-starter-tomcat"
}

application {
    applicationName = 'gradleExample'
    mainClass = 'com.example.Application'
}