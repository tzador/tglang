******************************************************************
* PROGRAM NAME:  EMPLOYEE DATA MANAGEMENT SYSTEM                  *
* AUTHOR:        JOHN SMITH                                      *
* DATE:          05/10/2021                                      *
* DESCRIPTION:   THIS PROGRAM ALLOWS THE USER TO ADD, MODIFY AND *
*                DISPLAY EMPLOYEE DATA IN A COMPANY DATABASE.    *
******************************************************************
IDENTIFICATION DIVISION.
PROGRAM-ID. EMPLOYEE_DATA.
ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT EMP-MSTR-FILE
       ASSIGN TO "EMPLOYEE.DAT"
       ORGANIZATION IS INDEXED
       ACCESS MODE IS DYNAMIC
       RECORD KEY IS EMPLOYEE-ID
       FILE STATUS IS FS-EMP.
    SELECT EMP-DISPLAY-FILE
       ASSIGN TO "EMPLOYEE_DISPLAY.TXT".
DATA DIVISION.
FILE SECTION.
FD EMP-MSTR-FILE
   LABEL RECORDS ARE STANDARD
   VALUE OF FILE-ID IS EMP-ID.
01 EMPLOYEE-RECORD.
   05 EMPLOYEE-ID       PIC X(10).
   05 EMPLOYEE-NAME     PIC X(25).
   05 EMPLOYEE-AGE      PIC 99.
   05 EMPLOYEE-GENDER   PIC X(6).
   05 EMPLOYEE-DEPT     PIC X(15).
   05 EMPLOYEE-SALARY   PIC 9(7).
FD EMP-DISPLAY-FILE
   LABEL RECORDS ARE STANDARD.
01 EMPLOYEE-OUT.
   05 EMPLOYEE-OUT-STRING PIC X(80).
WORKING-STORAGE SECTION.
77 FS-EMP           PIC 9(2) VALUE ZERO.
77 EMP-EOF          PIC X VALUE 'N'.
77 WS-CHOICE        PIC 99.
77 WS-EMPLOYEE-INDEX PIC 99.
01 WS-EMPLOYEE-ARRAY.
    05 WS-EMPLOYEE-DETAILS OCCURS 10 TIMES INDEXED BY WS-EMPLOYEE-INDEX.
       10 WS-EMP-DETAIL.
          15 WS-EMP-ID       PIC X(10).
          15 WS-EMP-NAME     PIC X(25).
          15 WS-EMP-AGE      PIC 99.
          15 WS-EMP-GENDER   PIC X(6).
          15 WS-EMP-DEPT     PIC X(15).
          15 WS-EMP-SALARY   PIC 9(7).
PROCEDURE DIVISION.
MAIN-ROUTINE.
    DISPLAY "WELCOME TO THE EMPLOYEE DATA MANAGEMENT SYSTEM.".
    PERFORM UNTIL EMP-EOF = 'Y'
       DISPLAY "PLEASE CHOOSE AN ACTION:".
       DISPLAY "1. ADD NEW EMPLOYEE".
       DISPLAY "2. MODIFY EXISTING EMPLOYEE DATA".
       DISPLAY "3. DISPLAY EMPLOYEE DATA".
       DISPLAY "4. EXIT PROGRAM".
       ACCEPT WS-CHOICE.
       PERFORM EVALUATE-CHOICE.
       PERFORM DISPLAY-MENU.
    END-PERFORM.
    CLOSE EMP-MSTR-FILE.
    CLOSE EMP-DISPLAY-FILE.
    STOP RUN.

EVALUATE-CHOICE.
    EVALUATE WS-CHOICE
        WHEN 1
            PERFORM ADD-EMPLOYEE
        WHEN 2
            PERFORM MODIFY-EMPLOYEE
        WHEN 3
            PERFORM DISPLAY-EMPLOYEE
        WHEN OTHER
            DISPLAY "INVALID CHOICE. PLEASE CHOOSE AGAIN.".
    END-EVALUATE.

ADD-EMPLOYEE.
    DISPLAY "PLEASE ENTER THE EMPLOYEE ID:".
    ACCEPT WS-EMP-ID.
    DISPLAY "PLEASE ENTER THE EMPLOYEE NAME:".
    ACCEPT WS-EMP-NAME.
    DISPLAY "PLEASE ENTER THE EMPLOYEE AGE:".
    ACCEPT WS-EMP-AGE.
    DISPLAY "PLEASE ENTER THE EMPLOYEE GENDER:".
    ACCEPT WS-EMP-GENDER.
    DISPLAY "PLEASE ENTER THE EMPLOYEE DEPARTMENT:".
    ACCEPT WS-EMP-DEPT.
    DISPLAY "PLEASE ENTER THE EMPLOYEE SALARY:".
    ACCEPT WS-EMP-SALARY.
    MOVE WS-EMP-ID TO EMPLOYEE-RECORD.
    MOVE WS-EMP-NAME TO EMPLOYEE-NAME.
    MOVE WS-EMP-AGE TO EMPLOYEE-AGE.
    MOVE WS-EMP-GENDER TO EMPLOYEE-GENDER.
    MOVE WS-EMP-DEPT TO EMPLOYEE-DEPT.
    MOVE WS-EMP-SALARY TO EMPLOYEE-SALARY.
    WRITE EMPLOYEE-RECORD INVALID KEY
        DISPLAY "ERROR WRITING TO FILE.".

MODIFY-EMPLOYEE.
    DISPLAY "WHICH EMPLOYEE'S DATA WOULD YOU LIKE TO MODIFY?".
    DISPLAY "PLEASE ENTER THE EMPLOYEE ID:".
    ACCEPT WS-EMP-ID.
    READ EMP-MSTR-FILE INVALID KEY
        DISPLAY "EMPLOYEE RECORD NOT FOUND.".
    DISPLAY "ENTER THE NEW EMPLOYEE NAME:".
    ACCEPT WS-EMP-NAME.
    DISPLAY "ENTER THE NEW EMPLOYEE AGE:".
    ACCEPT WS-EMP-AGE.
    DISPLAY "ENTER THE NEW EMPLOYEE GENDER:".
    ACCEPT WS-EMP-GENDER.
    DISPLAY "ENTER THE NEW EMPLOYEE DEPARTMENT:".
    ACCEPT WS-EMP-DEPT.
    DISPLAY "ENTER THE NEW EMPLOYEE SALARY:".
    ACCEPT WS-EMP-SALARY.
    MOVE WS-EMP-NAME TO EMPLOYEE-NAME.
    MOVE WS-EMP-AGE TO EMPLOYEE-AGE.
    MOVE WS-EMP-GENDER TO EMPLOYEE-GENDER.
    MOVE WS-EMP-DEPT TO EMPLOYEE-DEPT.
    MOVE WS-EMP-SALARY TO EMPLOYEE-SALARY.
    REWRITE EMPLOYEE-RECORD INVALID KEY
        DISPLAY "ERROR REWRITING TO FILE.".

DISPLAY-EMPLOYEE.
    OPEN OUTPUT EMP-DISPLAY-FILE.
    DISPLAY "EMPLOYEE ID  EMPLOYEE NAME               EMPLOYEE AGE GENDER  DEPARTMENT        SALARY".
    DISPLAY "-----------  ---------------------------   ------------ ------  ---------------   -------".
    PERFORM VARYING WS-EMPLOYEE-INDEX FROM 1 BY 1 UNTIL WS-EMPLOYEE-INDEX > 10
        READ EMP-MSTR-FILE AT END MOVE 'Y' TO EMP-EOF
        NOT AT END
            MOVE EMPLOYEE-RECORD TO WS-EMP-DETAIL
            MOVE WS-EMP-ID TO WS-EMP-DETAIL(WS-EMPLOYEE-INDEX)
            MOVE WS-EMP-NAME TO WS-EMP-DETAIL(WS-EMPLOYEE-INDEX)
            MOVE WS-EMP-AGE TO WS-EMP-DETAIL(WS-EMPLOYEE-INDEX)
            MOVE WS-EMP-GENDER TO WS-EMP-DETAIL(WS-EMPLOYEE-INDEX)
            MOVE WS-EMP-DEPT TO WS-EMP-DETAIL(WS-EMPLOYEE-INDEX)
            MOVE WS-EMP-SALARY TO WS-EMP-DETAIL(WS-EMPLOYEE-INDEX)
    END-PERFORM.
    PERFORM VARYING WS-EMPLOYEE-INDEX FROM 1 BY 1 UNTIL WS-EMPLOYEE-INDEX > 10
        MOVE WS-EMPLOYEE-DETAILS(WS-EMPLOYEE-INDEX) TO EMPLOYEE-OUT-STRING
        WRITE EMPLOYEE-OUT INVALID KEY
            DISPLAY "ERROR WRITING TO DISPLAY FILE."
    END-PERFORM.
    CLOSE EMP-DISPLAY-FILE.