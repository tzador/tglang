IDENTIFICATION DIVISION.
       PROGRAM-ID. CALCULATE-SALARY.
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT INFILE ASSIGN TO "PAYROLL.DAT"
           ORGANIZATION IS LINE SEQUENTIAL.
           SELECT OUTFILE ASSIGN TO "PAYROLL.RPT"
           ORGANIZATION IS LINE SEQUENTIAL.
           SELECT INFILE-INVALID ASSIGN TO "INVALID-PAYROLL.RPT"
           ORGANIZATION IS LINE SEQUENTIAL.
       DATA DIVISION.
       FILE SECTION.
       FD INFILE.
       01 DETAIL-LINE-IN PIC X(35).
       FD OUTFILE.
       01 DETAIL-LINE-OUT PIC X(60).
       FD INFILE-INVALID.
       01 DETAIL-INVALID PIC X(35).
       WORKING-STORAGE SECTION.
       COPY "CALCULATE-SALARY-CONST.CPY".
       01 TOTAL-SALARY PIC 9(8)V99 VALUE 0.
       01 TOTAL-BONUS PIC 9(6)V99 VALUE 0.
       01 TOTAL-COMMISSION PIC 9(7)V99 VALUE 0.
       01 TOTAL-DISCOUNT PIC 9(5)V99 VALUE 0.
       01 EMPLOYEE-COUNT PIC 99 VALUE 0.
       01 EMPLOYEE-DISPLAY PIC X(60).
       01 CURRENT-EMPLOYEE PIC 9(7).
       01 EMPLOYEE-TABLE.
           05 EMPLOYEE-ENTRY.
               10 EMPLOYEE-ID PIC 9(5).
               10 EMPLOYEE-NAME PIC X(20).
               10 EMPLOYEE-POSITION PIC X(10).
               10 EMPLOYEE-SALARY PIC 9(6)V99.
               10 EMPLOYEE-BONUS PIC 9(4)V99.
               10 EMPLOYEE-COMMISSION PIC 9(5)V99.
               10 EMPLOYEE-DISCOUNT PIC 9(4)V99.
       01 EOF-SWITCH PIC X VALUE 'N'.
       PROCEDURE DIVISION.
       BEGIN.
       OPEN INPUT INFILE
           OUTPUT OUTFILE
           OUTPUT INFILE-INVALID.
       READ INFILE
           AT END MOVE 'Y' TO EOF-SWITCH.
       PERFORM UNTIL EOF-SWITCH EQUALS 'Y'.
       MOVE DETAIL-LINE-IN TO DETAIL-INVALID.
       IF DETAIL-LINE-IN(6:7) = "10".
       ADD 1 TO EMPLOYEE-COUNT.
       MOVE EMPLOYEE-ENTRY TO EMPLOYEE-TABLE(EMPLOYEE-COUNT).
       COMPUTE TOTAL-SALARY = TOTAL-SALARY + EMPLOYEE-TABLE(EMPLOYEE-COUNT).EMPLOYEE-SALARY.
       COMPUTE TOTAL-BONUS = TOTAL-BONUS + EMPLOYEE-TABLE(EMPLOYEE-COUNT).EMPLOYEE-BONUS.
       COMPUTE TOTAL-COMMISSION = TOTAL-COMMISSION + EMPLOYEE-TABLE(EMPLOYEE-COUNT).EMPLOYEE-COMMISSION.
       COMPUTE TOTAL-DISCOUNT = TOTAL-DISCOUNT + EMPLOYEE-TABLE(EMPLOYEE-COUNT).EMPLOYEE-DISCOUNT.
       ELSE IF DETAIL-LINE-IN(6:7) = "20".
       COMPUTE TOTAL-SALARY = TOTAL-SALARY - EMPLOYEE-TABLE(EMPLOYEE-COUNT).EMPLOYEE-DISCOUNT.
       COMPUTE EMPLOYEE-TABLE(EMPLOYEE-COUNT).EMPLOYEE-BONUS = (TOTAL-SALARY * 0.1) - EMPLOYEE-TABLE(EMPLOYEE-COUNT).EMPLOYEE-DISCOUNT.
       ELSE IF DETAIL-LINE-IN(6:7) = "30".
       COMPUTE TOTAL-SALARY = TOTAL-SALARY + (TOTAL-COMMISSION * 0.05) - TOTAL-DISCOUNT.
       COMPUTE TOTAL-COMMISSION = TOTAL-COMMISSION + EMPLOYEE-TABLE(EMPLOYEE-COUNT).EMPLOYEE-COMMISSION.
       MOVE DETAIL-LINE-IN(8:12) TO CURRENT-EMPLOYEE.
       PERFORM VARYING EMPLOYEE-COUNT FROM 1 BY 1 UNTIL EMPLOYEE-COUNT = 0.
       IF EMPLOYEE-TABLE(EMPLOYEE-COUNT).EMPLOYEE-ID = CURRENT-EMPLOYEE.
       MOVE EMPLOYEE-TABLE(EMPLOYEE-COUNT).EMPLOYEE-SALARY TO EMPLOYEE-DISPLAY(1:10).
       MOVE EMPLOYEE-TABLE(EMPLOYEE-COUNT).EMPLOYEE-BONUS TO EMPLOYEE-DISPLAY(11:10).
       MOVE EMPLOYEE-TABLE(EMPLOYEE-COUNT).EMPLOYEE-COMMISSION TO EMPLOYEE-DISPLAY(21:10).
       MOVE EMPLOYEE-TABLE(EMPLOYEE-COUNT).EMPLOYEE-DISCOUNT TO EMPLOYEE-DISPLAY(31:10).
       MOVE EMPLOYEE-DISPLAY TO DETAIL-LINE-OUT.
       END-IF.
       PERFORM SORT-OUTPUT.
       WRITE OUTFILE FROM DETAIL-LINE-OUT.
       END-PERFORM.
       COMPUTE EMPLOYEE-TABLE(EMPLOYEE-COUNT).EMPLOYEE-SALARY = (TOTAL-SALARY / EMPLOYEE-COUNT) + TOTAL-BONUS - TOTAL-DISCOUNT.
       COMPUTE EMPLOYEE-TABLE(EMPLOYEE-COUNT).EMPLOYEE-COMMISSION = (TOTAL-SALARY * 0.05) / EMPLOYEE-COUNT.
       CLOSE INFILE
             OUTFILE
             INFILE-INVALID.
       SORT-OUTPUT.
       PERFORM VARYING EMPLOYEE-COUNT FROM 1 BY 1 UNTIL EMPLOYEE-COUNT = 0.
       MOVE EMPLOYEE-TABLE(EMPLOYEE-COUNT).EMPLOYEE-ID TO DETAIL-LINE-OUT(1:5).
       MOVE EMPLOYEE-TABLE(EMPLOYEE-COUNT).EMPLOYEE-NAME TO DETAIL-LINE-OUT(6:25).
       MOVE EMPLOYEE-TABLE(EMPLOYEE-COUNT).EMPLOYEE-POSITION TO DETAIL-LINE-OUT(26:10).
       WRITE OUTFILE FROM DETAIL-LINE-OUT.
       END-PERFORM.
       EXIT PROGRAM CALCULATE-SALARY.
       END PROGRAM CALCULATE-SALARY.