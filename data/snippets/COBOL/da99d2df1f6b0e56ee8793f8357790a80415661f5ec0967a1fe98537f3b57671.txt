INIT-PROCEDURE SECTION.
           PERFORM READ-FILE
           PERFORM CALCULATE-TOTALS
           PERFORM WRITE-REPORT
           PERFORM VALIDATE-REPORT

       READ-FILE SECTION.
           OPEN INPUT DATA-FILE
           PERFORM UNTIL EOF
                READ DATA-FILE INTO RECORD-IN
                IF NOT-VALID
                   MOVE 'INVALID RECORD' TO ERROR-MSG
                END-IF
                ADD 1 TO RECORDS-READ
                PERFORM PROCESS-RECORD
           END-PERFORM
           CLOSE DATA-FILE

       CALCULATE-TOTALS SECTION.
           PERFORM VARYING INDEX FROM 1 BY 1 UNTIL INDEX > MAX
               COMPUTE TOTAL-COST = TOTAL-COST + (QUANTITY(INDEX) * UNIT-PRICE(INDEX))
           END-PERFORM
           COMPUTE AVERAGE-COST = TOTAL-COST / RECORDS-READ

       WRITE-REPORT SECTION.
           OPEN OUTPUT REPORT-FILE
           PERFORM VARYING INDEX FROM 1 BY 1 UNTIL INDEX > MAX
               WRITE REPORT-RECORD FROM REPORT-LINE(INDEX)
           END-PERFORM
           CLOSE REPORT-FILE

       VALIDATE-REPORT SECTION.
           IF RECORDS-READ = 0
               MOVE 'NO RECORDS FOUND' TO ERROR-MSG
           END-IF

       PROCESS-RECORD SECTION.
           MOVE RECORD-IN TO REPORT-LINE(RECORDS-READ)
           PERFORM UNTIL EOF
                READ TAX-FILE INTO TAX-RECORD
                IF TAX-RECORD.ITEM-CODE = RECORD-IN.ITEM-CODE
                   COMPUTE TAX-AMOUNT = RECORD-IN.UNIT-PRICE * (TAX-RECORD.RATE/100)
                   COMPUTE TOTAL-COST = TOTAL-COST + TAX-AMOUNT
                   SET FOUND-SWITCH TO TRUE
                END-IF
           END-PERFORM
           IF NOT FOUND-SWITCH
               MOVE 'NO TAX INFO FOUND' TO ERROR-MSG
           END-IF