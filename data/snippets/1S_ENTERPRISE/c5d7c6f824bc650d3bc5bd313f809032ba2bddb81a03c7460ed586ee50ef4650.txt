&НаСервере // This keyword indicates that the code will be executed on the server side
ПрограммаРаботыСДанными()
	
	
	Процедура ЗапросПоКлиенту(ЭтотОбъект) Экспорт
		Запрос = Новый Запрос();
		
		// Создаем подзапрос и добавляем ему параметр для фильтрации по клиенту
		Подзапрос = Новый Подзапрос("Измерения.Счет", "ПланыСчетов.Клиенты", "Счет");
		Подзапрос.УстановитьПараметр("Клиент", ЭтотОбъект.Клиент);
		
		// Добавляем выбираемые поля и условия фильтрации
		Запрос.Текст = 
			"ВЫБРАТЬ
			|	ВИДЕНИЕ Платежи.Дата КАК Дата,
			|	Платежи.Сумма КАК Сумма,
			|	Платежи.Оплачено КАК Оплачено
			|ИЗ
			|	РегистрНакопления.Платежи КАК Платежи
			|ГДЕ
			|	Платежи.Клиент В (&Клиент)
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ
			|	ВИДЕНИЕ Продажи.Дата КАК Дата,
			|	Продажи.Сумма КАК Сумма,
			|	Продажи.Оплачено КАК Оплачено
			|ИЗ
			|	РегистрНакопления.Продажи КАК Продажи
			|ГДЕ
			|	Продажи.Клиент В (&Клиент)";
		
		Запрос.УстановитьПараметр("Клиент", ЭтотОбъект.Клиент);
	
		// Добавляем условия фильтрации на основе подзапроса
		Запрос.ДобавитьФильтр("Наименование", ТипЗначения.ЭтотОбъект+"."+ТипЗначения.ПервичныйКлюч, "&Вхождение(^"+Подзапрос.Вернуть()+"^)");
		
		// Добавляем сортировку по дате
		Запрос.Сортировки.Добавить("Дата");
		
		Выборка = Запрос.Выполнить().Выбрать();
		
		// Обрабатываем выборку и выводим результаты в таблицу
		Пока Выборка.Следующий() Цикл
			ДобавитьСтрокуВТаблицу(Выборка.Дата, Выборка.Сумма, Выборка.Оплачено);
		КонецЦикла;
	КонецПроцедуры

	Процедура ДобавитьСтрокуВТаблицу(Дата, Сумма, Оплачено) Экспорт
		// Ссылка на добавленную строку
		НоваяСтрока = ТабличныйДокумент.ТабличнаяЧасть.Добавить();
		
		// Устанавливаем значения для ячеек
		НоваяСтрока.Дата = Дата;
		НоваяСтрока.Сумма = Сумма;
		НоваяСтрока.Оплачено = Оплачено;
	КонецПроцедуры
КонецПрограммы