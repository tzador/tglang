#Список Организаций
СписокОрганизаций=ЗагрузитьСписокОрганизаций()

#Цикл по организациям
Для каждого Организация Из СписокОрганизаций Цикл
   #Получение информации о компании
   Инфо = ПолучитьИнформациюОКомпании(Организация)
   
   Если Инфо.Категория = "Производство" Тогда
       #Работа с продуктами компании
       Продукты = ПолучитьСписокПродуктов(Инфо)
       Для каждого Продукт Из Продукты Цикл
           #Анализ популярности продукта
           Популярность = АнализироватьПопулярностьПродукта(Продукт)
           Если Популярность > 0 Тогда
               #Отправка отчета об анализе продукта
               ОтправитьОтчет(Инфо, Продукт, Популярность)
           КонецЕсли
       КонецЦикла
   КонецЕсли
    
    Если Инфо.Категория = "Торговля" Тогда
       #Работа с товарами компании
       Товары = ПолучитьСписокТоваров(Инфо)
       Для каждого Товар Из Товары Цикл
           #Анализ рентабельности товара
           Рентабельность = АнализироватьРентабельностьТовара(Товар)
           Если Рентабельность > 10 Тогда
               #Отправка отчета о рентабельности товара
               ОтправитьОтчет(Инфо, Товар, Рентабельность)
           КонецЕсли
       КонецЦикла
   КонецЕсли
   
   #Получение списка сотрудников компании
   Сотрудники = ПолучитьСписокСотрудников(Инфо)
   Для каждого Сотрудник Из Сотрудники Цикл
       #Анализ стажа работы сотрудника
       Стаж = АнализироватьСтажСотрудника(Сотрудник)
       Если Стаж > 2 Тогда
           #Отправка отчета о стаже сотрудника
           ОтправитьОтчет(Инфо, Сотрудник, Стаж)
       КонецЕсли
   КонецЦикла
КонецЦикла

#Функция получения информации о компании
Функция ПолучитьИнформациюОКомпании(Организация)
   #Запрос к базе данных о компании
   Результат = ВыполнитьЗапрос(Выбрать Из Компании Где Наименование = Организация)
   
   #Заполнение структуры с информацией о компании
   ИнфомрмацияОКомпании = Структура()
   Инфо.Категория = Результат.Категория
   Инфо.Адрес = Результат.Адрес
   
   Возврат ИнформацияОКомпании
КонецФункции

#Функция получения списка продуктов компании
Функция ПолучитьСписокПродуктов(Инфо)
   #Запрос к базе данных о продуктах
   Результат = ВыполнитьЗапрос(Выбрать Из Продукты Где Компания = Инфо.Адрес)
   
   #Создание списка продуктов
   СписокПродуктов = Список()
   Для каждого Элемент Из Результат Цикл
       #Добавление продукта в список
       СписокПродуктов.Добавить(Элемент.Наименование)
   КонецЦикла
   
   Возврат СписокПродуктов
КонецФункции

#Функция получения списка товаров компании
Функция ПолучитьСписокТоваров(Инфо)
   #Запрос к базе данных о товарах
   Результат = ВыполнитьЗапрос(Выбрать Из Товары Где Компания = Инфо.Адрес)
   
   #Создание списка товаров
   СписокТоваров = Список()
   Для каждого Элемент Из Результат Цикл
       #Добавление товара в список
       СписокТоваров.Добавить(Элемент.Наименование)
   КонецЦикла
   
   Возврат СписокТоваров
КонецФункции

#Функция получения списка сотрудников компании
Функция ПолучитьСписокСотрудников(Инфо)
   #Запрос к базе данных о сотрудниках
   Результат = ВыполнитьЗапрос(Выбрать Из Сотрудники Где Компания = Инфо.Адрес)
   
   #Создание списка сотрудников
   СписокСотрудников = Список()
   Для каждого Элемент Из Результат Цикл
       #Добавление сотрудника в список
       СписокСотрудников.Добавить(Элемент.ФИО)
   КонецЦикла
   
   Возврат СписокСотрудников
КонецФункции

#Функция анализа популярности продукта
Функция АнализироватьПопулярностьПродукта(Продукт)
   #Запрос к базе данных о популярности продукта
   Результат = ВыполнитьЗапрос(Выбрать Из ПопулярностьПродукта Где Наименование = Продукт)
   
   Возврат Результат.Популярность
КонецФункции

#Функция анализа рентабельности товара
Функция АнализироватьРентабельностьТовара(Товар)
   #Запрос к базе данных о рентабельности товара
   Результат = ВыполнитьЗапрос(Выбрать Из РентабельностьТовара Где Наименование = Товар)
   
   Возврат Результат.Рентабельность
КонецФункции

#Функция анализа стажа работы сотрудника
Функция АнализироватьСтажСотрудника(Сотрудник)
   #Запрос к базе данных о стаже работы сотрудника
   Результат = ВыполнитьЗапрос(Выбрать Из СтажСотрудника Где ФИО = Сотрудник)
   
   Возврат Результат.Стаж
КонецФункции

#Функция отправки отчета
Функция ОтправитьОтчет(Инфо, Объект, Значение)
   #Создание сообщения с информацией об объекте и его значении
   Сообщение = "Отчет о " + Объект.GetType() + ": " + Объект + " Значение: " + Значение
   
   #Создание адресата сообщения
   Адресат = Инфо.Адрес + "@domain.com"
   
   #Отправка сообщения
   ОтправитьПисьмо(Адресат, Сообщение)
КонецФункции