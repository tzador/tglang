// This code snippet is a sample function to calculate the total salary of employees from different departments

Функция РасчетЗарплатыРаботников(ДатаНачала, ДатаОкончания) Экспорт
    // Декларация переменных суммы и общего количества часов
    Сумма = 0;
    ОбщееКоличествоЧасов = 0;

    // Перебираем всех работников
    Для Каждого Работник Из Справочник.Сотрудники Цикл
        // Проверяем, если работник активен и его дата приема на работу раньше или равна указанной дате начала
        Если Работник.Активный И Работник.ДатаПриема <= ДатаНачала Тогда
            // Выбираем все записи времени работы за указанный период
            ОбщееКоличествоЧасов = ОбщееКоличествоЧасов + ВыборкаПоЗапросу(
                "ВЫБРАТЬ
                |    SUM(таб.НаКоличествоЧасов) КАК ВсегоЧасов
                |ИЗ
                |    РегистрНакопления.ТабельУчетаРабочегоВремени КАК таб
                |ГДЕ
                |    таб.Работник = &Работник
                |    И таб.ДатаРаботы МЕЖДУ &ДатаНачала И &ДатаОкончания",
                Работник = Работник,
                ДатаНачала = ДатаНачала,
                ДатаОкончания = ДатаОкончания
            ).ВсегоЧасов;

            // Выбираем подразделение работника
            Подразделение = Работник.Подразделение;

            // Проверяем, если подразделение не пустое и оно существует
            Если ЗначениеЗаполнено(Подразделение) И Подразделение.Содержит(Справочник.Подразделения) Тогда
                // Выбираем ставку оплаты для подразделения и расчитываем зарплату
                СтавкаОплаты = ВыборкаПоЗапросу(
                    "ВЫБРАТЬ
                    |    Подразделение.Ставка Остаток (РегистрСведений.СтавкиОплатыЗаСменуНаПодразделении.ДатаДействия = &ДатаОкончания) КАК Ставка
                    |ИЗ
                    |    Справочник.Подразделения КАК Подразделение
                    |        ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтавкиОплатыЗаСменуНаПодразделении КАК СтавкиОплаты
                    |        ПО (СтавкиОплаты.ДатаДействия = &ДатаОкончания)
                    |   ГДЕ
                    |    Подразделение.ГоловноеПодразделение В ИЕРАРХИИ (&Подразделение)
                    |       И СтавкиОплаты.Подразделение = Подразделение,
                    |    УПОРЯДОЧИТЬ ПО
                    |       СтавкиОплаты.ДатаДействия УБЫВ"
                    ДатаОкончания = ДатаОкончания,
                    Подразделение = Подразделение
                ).Ставка;

                // Минимальная ставка оплаты в случае отсутствия записей ставок на подразделение
                МинимальнаяСтавка = 100;

                // Если ставка не пустая и она больше минимальной, то добавляем расчитанную зарплату к общей сумме
                Если ЗначениеЗаполнено(СтавкаОплаты) И СтавкаОплаты > МинимальнаяСтавка Тогда
                    Сумма = Сумма + (СтавкаОплаты * ОбщееКоличествоЧасов);
                КонецЕсли;
            КонецЕсли;
        КонецЕсли;
    КонецЦикла;

    // Возвращаем сумму зарплаты
    Возврат Сумма;

КонецФункции