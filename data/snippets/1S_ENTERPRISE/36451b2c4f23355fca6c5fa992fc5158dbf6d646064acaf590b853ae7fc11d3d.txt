СоздатьОбъект(Тип("ДокументОбработка.ЗаказНаПоставку"), ЗаказНаПоставку, Данные);
ЗаказНаПоставку.Заполнить(ЗаказНаПоставку, Данные);

// определение особенностей товара

ЗапросНаПолучение = новый Запрос;
ЗапросНаПолучение.Текст = 
"
    ВЫБРАТЬ
        Товары.Наименование,
        Номенклатура.СписокХарактеристикПродукции
    ИЗ
        Справочник.Товары КАК Товары,
        Справочник.Номенклатура КАК Номенклатура
    ГДЕ
        Товары.Наименование = &Наименование
    ОБЪЕДИНИТЬ ВСЕ
    ВЫБРАТЬ
        ТоварыНаСкладахОстатки.Наименование,
        Номенклатура.СписокХарактеристикПродукции
    ИЗ
        РегистрНаСкладах.ТоварыНаСкладах.Остатки(
            , 
            &Дата,
            Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
            И Укажите ИсключитьПроведенные(true)
        ) КАК ТоварыНаСкладахОстатки,
        Справочник.Номенклатура КАК Номенклатура
    ПО
        ТоварыНаСкладахОстатки.Номенклатура = Номенклатура.Ссылка
        И Номенклатура.СписокХарактеристикПродукции.Найти(&ХарактеристикаПродукции) <> Неопределено
";

ЗапросНаПолучение.УстановитьПараметр("Наименование", Товар.Наименование);
ЗапросНаПолучение.УстановитьПараметр("Дата", Дата);
ЗапросНаПолучение.УстановитьПараметр("ХарактеристикаПродукции", Характеристика.Наименование);

РезультатЗапросаНаПолучение = ЗапросНаПолучение.Выполнить().Выбрать();

// проверка на наличие характеристики
Если РезультатЗапросаНаПолучение.Количество() > 0 Тогда
    Товар.Особенность = РезультатЗапросаНаПолучение.Наименование;
КонецЕсли;

// создание новой строки таблицы ЗаказНаПоставку
НоваяСтрока = ЗаказНаПоставку.Товары.Добавить();
НоваяСтрока.Номенклатура = Товар;
Если Товар.Особенность <> Неопределено Тогда
    НоваяСтрока.Особенность = Товар.Особенность;
КонецЕсли;

// расчет итоговой стоимости заказа
ИтоговаяСтоимость = 0;
Для каждого Строка из ЗаказНаПоставку.Товары Цикл
    Если Строка.Цена <> 0 Тогда
        ИтоговаяСтоимость = ИтоговаяСтоимость + (Строка.Количество * Строка.Цена);
    КонецЕсли;
КонецЦикла;

ЗаказНаПоставку.ИтоговаяСтоимость = ИтоговаяСтоимость;

ИУПриемНЗП = новый ИнтерфейсОбработки();
ИУПриемНЗП.ОбработкаДанных(ЗаказНаПоставку);