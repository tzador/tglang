/*
This code snippet is for a 1C Enterprise program.
It creates a report with data from a database.
*/

#Область Расчет
ДатыС = "01.01.2020"; #Дата начала отчетного периода
ДатыПо = "31.12.2020"; #Дата конца отчетного периода
АнализПродаж = ЛОЖЬ; #Показывать ли данные о продажах

#Если АнализПродаж = ЛОЖЬ тогда
НачалоПериода = ?ДатыС;
КонецПериода = ?ДатыПо;
Иначе
НачалоПериода = К над(__Дата, -?ДатыС);
КонецПериода = К над(__Дата, -?ДатыПо);
КонецЕсли

#УровеньУправления = Расшифровка;
Бренды = Ложь; #Флаг "Группировать по брендам"
СтатьиЗатрат = Ложь; #Флаг "Группировать по статьям затрат"

#Запрос "КЗатратыАвтомобилей" (ПериодОт, ПериодДо)
	
#Если АнализПродаж Тогда 
	Вывести ВАГРЫПОПРОДАЖАМ; #Вызвать процедуру для получения данных о продажах
Иначе
	Вывести ВАГРЫПОРЕЗЕРВНЫХ; #Вызвать процедуру для получения данных о резервных затратах
КонецЕсли

Вывести ВАТЕГОРИИ; #Вызвать процедуру для получения данных о категориях затрат

#Если Бренды Тогда
	Установить ТаблицаЭлементов.Колонки.Вставить("Бренды"); #Добавить столбец для группировки по брендам
КонецЕсли

#Если СтатьиЗатрат Тогда
	Установить ТаблицаЭлементов.Колонки.Вставить("Статьи затрат"); #Добавить столбец для группировки по статьям затрат
КонецЕсли

#Если АнализПродаж Тогда
	Установить ТаблицаЭлементов.Итоги.Вставить(ВАГРЫИТОГИ); #Добавить итоги по продажам
КонецЕсли

#Выбрать //ВыводКолонок//, СУММА(!Количество!*!Цена!) КАК //СуммаРеализации//, СУММА(!Количество!*!Цена!)*!СтавкаНдсРеализации!/100 КАК //СуммаНдсРеализации//, СУММА(!Сумма->Резерв!/100) КАК //СуммаРезерв//, СУММА(!Сумма->Резерв!*!СтавкаНдсРезерв!/10000) КАК //СуммаНдсРезерв//
ИЗ Движение //Номенклатура//
ГДЕ ДокументНашеОборотыПоНоменклатуре::Документ.Дата В {НачалоПериода}...<= {КонецПериода}
СГРУППИРОВАТЬ ПО //Период//, ?Бренды, ?СтатьяЗатрат
СОРТИРОВАТЬ ПО //Период//, !КодНоменклатуры;

#Область "Отчет"
ОбщийОтчет = СоздатьОбъект("Отчет.ОборотыПоНоменклатуре"); #Создание объекта отчета
ОбщийОтчет.ПереключитьУровеньУправления(УровеньУправления); #Установка уровня управления
ОбщийОтчет.АнализПродаж = АнализПродаж; #Установка настроек отчета
ОбщийОтчет.СтатьиЗатрат = СтатьиЗатрат;
ОбщийОтчет.Бренды = Бренды;
ОбщийОтчет.Параметры.ДатаНачало = НачалоПериода; #Установка параметров отчета
ОбщийОтчет.Параметры.ДатаКонец = КонецПериода;
ОбщийОтчет.ВыбратьДанныеДляОтчета(Запрос); #Выбор данных для отчета
ОбщийОтчет.Сформировать(); #Формирование отчета
ОбщийОтчет.Показать(); #Открытие отчета на экране