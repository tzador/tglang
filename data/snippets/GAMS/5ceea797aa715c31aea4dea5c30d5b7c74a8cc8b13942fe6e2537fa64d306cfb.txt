set i "indices for factory locations" /i1, i2, i3, i4, i5, i6, i7, i8/;
set j "indices for product types" /j1, j2, j3, j4, j5, j6, j7, j8/;
set k "indices for materials" /k1, k2, k3, k4, k5/;
alias (i,ii);
alias (j,jj);
set ij(i,j) "production combinations (factory i, product type j)";
parameter f(i) "fixed cost of building factory i";
parameter c(j,k) "consumption of material k for product type j";
parameter p(j) "unit selling price of product type j";
parameter s(i) "unit storage cost of product type j at factory i";
parameter d(i,j) "demand of product type j at factory i";
parameter u(i) "maximum storage capacity at factory i";
positive variable x(i,j) "production quantities";
binary variable y(i,j) "1 if production at factory i for product type j, 0 otherwise";
equation obj "objective function";
obj.. sum(i, j, f(i)*y(i,j) + sum(ij, c(ii,jj) * x(ii,jj))) =e= sum(i, j, p(j)*y(i,j)) - sum(i, j, s(i)*y(i,j));
equation limit(i,j) "storage capacity constraint";
limit(i,j).. x(i,j) =l= u(i) * y(i,j);
equation demand(i,j) "demand constraint";
demand(i,j).. x(i,j) =g= d(i,j);
model transport /all/;
solve transport maximizing obj using mip;
display x.l, obj.l;