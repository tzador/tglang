*&---------------------------------------------------------------------*
*& Report ZDEMO_REPORT
*&---------------------------------------------------------------------*
*&
*& Define global data
*&
*&---------------------------------------------------------------------*
DATA: i_vbeln TYPE i,
      i_vbeln_initial TYPE i VALUE 0.

*&---------------------------------------------------------------------*
*& Start-of-selection event
*&---------------------------------------------------------------------*
START-OF-SELECTION.

*&---------------------------------------------------------------------*
*& Get sales orders data
*&---------------------------------------------------------------------*
SELECT vbeln
  FROM vbak
  INTO TABLE @DATA(t_vbeln).

*&---------------------------------------------------------------------*
*& Loop through data
*&---------------------------------------------------------------------*
LOOP AT t_vbeln ASSIGNING FIELD-SYMBOL(<line>).
  i_vbeln = <line>-vbeln.

  *&---------------------------------------------------------------------*
  *& Process data
  *&---------------------------------------------------------------------*
  PERFORM process_data USING i_vbeln.

ENDLOOP.

*&---------------------------------------------------------------------*
*& Form process_data
*&---------------------------------------------------------------------*
FORM process_data USING p_vbeln TYPE i.

  *&---------------------------------------------------------------------*
  *& Print sales order number
  *&---------------------------------------------------------------------*
  WRITE: / 'Sales Order Number:', p_vbeln.

  *&---------------------------------------------------------------------*
  *& Get sales order items
  *&---------------------------------------------------------------------*
  SELECT vbeln posnr
    FROM vbap
    INTO TABLE @DATA(t_items)
    WHERE vbeln = p_vbeln.

 *&---------------------------------------------------------------------*
  *& Loop through items
  *&---------------------------------------------------------------------*
  LOOP AT t_items ASSIGNING FIELD-SYMBOL(<item>).
    WRITE: / <item>-posnr.
  ENDLOOP.

ENDFORM.  "process_data

*&---------------------------------------------------------------------*
*& End-of-selection event
*&---------------------------------------------------------------------*
END-OF-SELECTION.