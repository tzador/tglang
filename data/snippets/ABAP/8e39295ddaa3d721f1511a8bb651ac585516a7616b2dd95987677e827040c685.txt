REPORT Z_PROG_1.

TABLES: PERNR, ZEMP, ZDEPT.
DATA: NAME TYPE STRING,
      SALARY TYPE I,
      DEPTNO TYPE C,
      TEMP TYPE P DECIMALS 2.

* Selection screen
SELECT-OPTIONS: S_EMP FOR PERNR-EMP_NO,
                S_YEAR FOR ZEMP-START_DATE YEAR NO-DISPLAY.

* Internal tables
DATA: IT_EMPLOYEE TYPE TABLE OF PERNR.

* Selection
SELECT PERNR-EMP_NO, ZEMP-ENAME, ZEMP-SALARY, ZDEPT-DEPT_NO
  FROM PERNR
  INNER JOIN ZEMP ON PERNR-EMP_NO = ZEMP-EMP_NO
  INNER JOIN ZDEPT ON ZEMP-DEPT_ID = ZDEPT-ID
  INTO CORRESPONDING FIELDS OF TABLE IT_EMPLOYEE
  WHERE PERNR-EMP_NO IN S_EMP AND
        ZEMP-START_DATE BETWEEN S_YEAR AND SY-DATUM.

* Processing
LOOP AT IT_EMPLOYEE INTO DATA(EMPLOYEE).
  CALCULATE_HRA( EMPLOYEE-SALARY,
                 EXPORTING
                 DEPTNO = EMPLOYEE-DEPT_NO
                 IMPORTING
                 TEMP = TEMP ).

  WRITE: / 'Name:', EMPLOYEE-ENAME, '|',
          'Salary:', EMPLOYEE-SALARY, '|',
          'Department:', EMPLOYEE-DEPT_NO, '|'
          'HRA:', TEMP.
ENDLOOP.

FORM CALCULATE_HRA USING P_SALARY TYPE I
                       P_DEPTNO TYPE C
               CHANGING P_TEMP TYPE P.
  CASE P_DEPTNO.
    WHEN 'A'.
      P_TEMP = P_SALARY * 0.3.
    WHEN 'B'.
      P_TEMP = P_SALARY * 0.25.
    WHEN 'C'.
      P_TEMP = P_SALARY * 0.2.
  ENDCASE.
ENDFORM.